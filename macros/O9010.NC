%
O9010 (SPINDLE LOAD LOGGER)
(LOGS #1098 SPINDLE LOAD VIA DPRNT AT CONFIGURABLE INTERVAL)
(OUTPUT: CSV-READY -- SAMPLE,TIME_S,LOAD_PCT,RPM,POWER_KW,CUM_ENERGY_KJ)
(REQUIRES: SETTING 261 = FILE OR TCP, SETTING 262 = PATH)
(
( SETUP:
( 1. SETTING 261 -> FILE OR TCP PORT
( 2. SETTING 262 -> OUTPUT FOLDER OR USB PATH
( 3. LOAD THIS PROGRAM INTO MEMORY
( 4. CALL M98 P9010 FROM MAIN PROGRAM OR RUN STANDALONE
(
( CONFIGURATION -- EDIT FOR YOUR MACHINE:
#500 = 11.2       (CONTINUOUS KW -- 11.2 FOR 30HP, 7.5 FOR 20HP)
#501 = 1.0        (SAMPLE INTERVAL SECONDS)
#502 = 600        (MAX SAMPLES -- 600 = 10 MIN AT 1S)

(--- WORKING VARIABLES ---)
#510 = 0          (SAMPLE COUNTER)
#511 = 0          (ELAPSED TIME S)
#512 = 0          (CUMULATIVE ENERGY KJ)

G103 P1 (LIMIT LOOK-AHEAD FOR REAL-TIME LOGGING)

(OUTPUT CSV HEADER)
DPRNT[SAMPLE,TIME_S,LOAD_PCT,RPM,POWER_KW,CUM_ENERGY_KJ]

N100
(READ SPINDLE LOAD AND RPM)
#520 = #1098      (SPINDLE LOAD PCT - VECTOR DRIVE READ-ONLY)
#521 = #3027      (SPINDLE RPM - ACTUAL READ-ONLY)

(CALCULATE POWER: LOAD / 100 * CONTINUOUS KW)
#522 = [#520 / 100.0] * #500

(ACCUMULATE ENERGY: POWER_KW * INTERVAL_S = KJ)
#512 = #512 + [#522 * #501]

(OUTPUT CSV LINE)
DPRNT[#510[40],#511[52],#520[52],#521[60],#522[52],#512[52]]

(INCREMENT COUNTERS)
#510 = #510 + 1
#511 = #511 + #501

(DWELL FOR SAMPLE INTERVAL)
G04 P#501

(LOOP UNTIL MAX SAMPLES)
IF [#510 LT #502] GOTO 100

DPRNT[LOG_COMPLETE]
G103 P0
M99
%
